---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Desarrollo Web Villa Carlos Paz | Diseño Web Profesional | hgaruna"
  description="Desarrollo web profesional en Villa Carlos Paz, Córdoba. Creamos sitios web personalizados, e-commerce y marketing digital para negocios locales. Precios accesibles desde $150. ¡Consulta gratuita!"
  keywords="desarrollo web villa carlos paz, diseño web carlos paz, marketing digital córdoba, sitios web profesionales, seo local, e-commerce villa carlos paz, programador web villa carlos paz, diseñador web córdoba, crear sitio web villa carlos paz, agencia digital villa carlos paz, web developer villa carlos paz, tienda online villa carlos paz, google my business villa carlos paz, posicionamiento web córdoba, desarrollo de software villa carlos paz"
  ogTitle="Desarrollo Web Villa Carlos Paz | Sitios Web Profesionales | hgaruna"
  ogDescription="Desarrollo web profesional en Villa Carlos Paz, Córdoba. Sitios web personalizados para negocios locales con las mejores tecnologías. Precios desde $150. ¡Consulta gratuita!"
  ogImage="https://service.hgaruna.org/logos-he-imagenes/logo3.png"
  ogUrl="https://service.hgaruna.org/"
  twitterTitle="Desarrollo Web Villa Carlos Paz | Sitios Web Profesionales | hgaruna"
  twitterDescription="Desarrollo web profesional en Villa Carlos Paz, Córdoba. Sitios web personalizados para negocios locales con las mejores tecnologías. Precios desde $150."
  twitterImage="https://service.hgaruna.org/logos-he-imagenes/logo3.png"
  twitterUrl="https://service.hgaruna.org/"
>
  <section class="feed-section">
    <h2>Últimos Artículos</h2>
    <div id="latest-articles" class="feed-list"></div>
  </section>
  <section class="feed-section">
    <h2>Foro</h2>
    <div id="latest-forum-posts" class="feed-list"></div>
  </section>

  <!-- Modal para mostrar artículo completo -->
  <div id="article-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:#fff; max-width:600px; width:90vw; margin:auto; border-radius:8px; padding:24px; position:relative; box-shadow:0 8px 32px rgba(0,0,0,0.2);">
      <button class="modal-close" style="position:absolute; top:12px; right:12px; background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
      <h2 class="modal-title" style="margin-top:0;"></h2>
      <div class="modal-meta" style="color:#666; font-size:0.95em; margin-bottom:8px;">
        <span class="modal-author"></span> | <span class="modal-date"></span>
      </div>
      <div class="modal-content" style="white-space:pre-line; margin-bottom:16px;"></div>
    </div>
  </div>
  <!-- Fin modal artículo -->

  <script>
  async function loadFeed() {
    // Artículos
    try {
      const res = await fetch('/.netlify/functions/get-articles');
      const data = await res.json();
      const articles = Array.isArray(data) ? data : (data.articles || data);
      const latestArticles = articles.slice(0, 3);
      const container = document.getElementById('latest-articles');
      if (container) {
        container.innerHTML = latestArticles.map((a, idx) => `
          <div class=\"feed-card\" data-article-idx=\"${idx}\">
            <div class=\"feed-card-title\">${a.title}</div>
            <div class=\"feed-card-meta\">Por ${a.author} | ${a.createdAt ? new Date(a.createdAt).toLocaleString() : ''}</div>
            <div class=\"feed-card-content\">${a.content?.slice(0, 120) || ''}${a.content && a.content.length > 120 ? '...' : ''}</div>
          </div>
        `).join('');
        Array.from(container.querySelectorAll('.feed-card')).forEach((el, idx) => {
          el.onclick = () => showFullArticle(articles[idx]);
        });
      }
    } catch {}
    // Foro
    try {
      const res = await fetch('/.netlify/functions/get-forum-posts');
      const data = await res.json();
      const posts = Array.isArray(data) ? data : (data.posts || data);
      const latestPosts = posts.slice(0, 3);
      const container = document.getElementById('latest-forum-posts');
      if (container) {
        container.innerHTML = latestPosts.map(p => `
          <div class=\"feed-card\">
            <div class=\"feed-card-title\">${p.title}</div>
            <div class=\"feed-card-meta\">Por ${p.author} | ${p.createdAt ? new Date(p.createdAt).toLocaleString() : ''}</div>
            <div class=\"feed-card-content\">${p.content?.slice(0, 120) || ''}${p.content && p.content.length > 120 ? '...' : ''}</div>
          </div>
        `).join('');
      }
    } catch {}
  }
  function showFullArticle(article) {
    const modal = document.getElementById('article-modal');
    if (!modal) return;
    modal.querySelector('.modal-title').textContent = article.title;
    modal.querySelector('.modal-author').textContent = article.author;
    modal.querySelector('.modal-date').textContent = article.createdAt ? new Date(article.createdAt).toLocaleString() : '';
    modal.querySelector('.modal-content').textContent = article.content;
    modal.style.display = 'block';
  }
  window.addEventListener('DOMContentLoaded', () => {
    loadFeed();
    const modal = document.getElementById('article-modal');
    if (modal) {
      modal.querySelector('.modal-close').onclick = () => {
        modal.style.display = 'none';
      };
    }
  });
  </script>
</BaseLayout>